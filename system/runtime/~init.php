<?php
 if (version_compare(PHP_VERSION, '5.3.0', '<')) { exit('InfoPotato requires PHP 5.3.0 or newer. You are currently running PHP '. PHP_VERSION .'.'); } unset($_GET, $_REQUEST, $_ENV, $GLOBALS); switch (ENVIRONMENT) { case 'development': if (version_compare(PHP_VERSION, '5.4.0', '<')) { ini_set('error_reporting', E_ALL | E_STRICT); } else { ini_set('error_reporting', E_ALL); } break; case 'production': ini_set('error_reporting', 0); break; default: exit('The application environment is not set correctly.'); } spl_autoload_register(function ($class_name) { $class_name = strtolower($class_name); $core = array( 'dispatcher', 'manager', 'dumper', 'logger', 'validator', 'php_utf8', 'i18n', 'cookie', 'session', 'data', 'base_dao', 'mysql_dao', 'mysqli_dao', 'postgresql_dao', 'sqlite_dao', ); if (in_array($class_name, $core)) { $source_file = SYS_CORE_DIR.$class_name.'.php'; if ( ! file_exists($source_file)) { halt('An Error Was Encountered', "Missing core component file {$class_name}", 'sys_error'); } if (RUNTIME_CACHE === TRUE) { $file = SYS_RUNTIME_CACHE_DIR.'~'.$class_name.'.php'; if ( ! file_exists($file)) { file_put_contents($file, php_strip_whitespace($source_file)); } } else { $file = $source_file; } } else { $source_file = APP_MANAGER_DIR.$class_name.'.php'; if ( ! file_exists($source_file)) { halt('An Error Was Encountered', "Manager file {$class_name} does not exist", 'sys_error'); } if (RUNTIME_CACHE === TRUE) { $file = APP_RUNTIME_CACHE_DIR.'~'.$class_name.'.php'; if ( ! file_exists($file)) { file_put_contents($file, php_strip_whitespace($source_file)); } } else { $file = $source_file; } } require $file; }); function halt($heading, $message, $template = 'sys_error') { Logger::log_debug(APP_LOG_DIR, $message); if (ENVIRONMENT === 'development') { ob_start(); require SYS_CORE_DIR.'sys_templates'.DS.$template.'.php'; $output = ob_get_contents(); ob_end_clean(); } if (ENVIRONMENT === 'production') { if (defined('APP_404_MANAGER') && defined('APP_404_MANAGER_METHOD')) { $output = file_get_contents(APP_URI_BASE.APP_404_MANAGER.'/'.APP_404_MANAGER_METHOD); } else { $output = file_get_contents(SYS_CORE_DIR.'sys_templates'.DS.'404_error.php'); } header('HTTP/1.1 404 Not Found'); } echo $output; exit; } function dump($var, $force_type = '', $collapsed = FALSE) { Dumper::dump($var, $force_type, $collapsed); } function __($str, array $values = NULL) { $str = I18n::get($str); return empty($values) ? $str : strtr($str, $values); } 